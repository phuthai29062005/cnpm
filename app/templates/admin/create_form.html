<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>{{ title }} - Quản lý Dân cư</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }
        body { background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%); display: flex; min-height: 100vh; }
        
        .sidebar { width: 260px; background: #2c3e50; color: white; height: 100vh; position: fixed; }
        .logo { padding: 25px; text-align: center; border-bottom: 1px solid rgba(255,255,255,0.1); font-weight: bold; font-size: 1.4rem; background: rgba(0,0,0,0.1); }
        .menu-item { padding: 15px 25px; display: block; color: #ecf0f1; text-decoration: none; border-left: 4px solid transparent; }
        .menu-item:hover { background: rgba(255,255,255,0.05); border-left-color: #3498db; }
        
        .main-content { flex: 1; margin-left: 260px; padding: 30px; }
        
        .header-form { 
            background: white; padding: 20px 30px; border-radius: 12px; margin-bottom: 25px; 
            display: flex; justify-content: space-between; align-items: center; 
            box-shadow: 0 5px 15px rgba(0,0,0,0.05); 
        }
        .form-container { 
            background: white; border-radius: 12px; padding: 40px; 
            box-shadow: 0 5px 15px rgba(0,0,0,0.05); 
        }
        
        .form-group { margin-bottom: 25px; }
        label { display: block; margin-bottom: 10px; font-weight: 600; color: #34495e; }
        
        input[type="text"], input[type="date"], input[type="number"], select, textarea {
            width: 100%; padding: 12px 15px; border: 1px solid #ddd; border-radius: 8px; font-size: 1rem; transition: 0.3s;
        }
        input:focus, select:focus, textarea:focus { border-color: #3498db; outline: none; box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1); }
        
        /* [FIX QUAN TRỌNG] Sửa lỗi Radio Button */
        ul { 
        list-style-type: none; 
        padding: 0; 
        margin: 0; 
        display: flex; 
        flex-direction: column; /* Ép xuống dòng */
        gap: 10px; 
        }
        ul li { 
            display: flex; 
            align-items: center; 
            width: 100%; /* Chiếm toàn bộ chiều rộng dòng đó */
            padding: 5px 0;
        }
        input[type="radio"] { width: auto; margin-right: 8px; transform: scale(1.2); cursor: pointer; }
        
        .btn { padding: 12px 25px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; color: white; text-decoration: none; display: inline-flex; align-items: center; gap: 8px; transition: 0.2s; }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 5px 10px rgba(0,0,0,0.1); }
        .btn-primary { background: linear-gradient(135deg, #3498db, #2980b9); }
        .btn-secondary { background: #95a5a6; }
        
        .alert { padding: 15px; margin-bottom: 20px; border-radius: 8px; color: white; background: #e74c3c; display: flex; align-items: center; gap: 10px; }
        .alert-success { background: #27ae60; }
    </style>
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <style>
        /* Tùy chỉnh để thanh tìm kiếm trông đẹp hơn và khớp với giao diện của bạn */
        .select2-container--default .select2-selection--single {
            height: 45px !important;
            border: 1px solid #ddd !important;
            border-radius: 8px !important;
            padding: 8px !important;
        }
        .select2-container { width: 100% !important; margin-top: 5px; }
    </style>
</head>
<body>
    <div class="sidebar">
        <div class="logo"><i class="fas fa-city me-2"></i>QUẢN LÝ DÂN CƯ</div>
        <div class="menu" style="padding-top:20px;">
            <a class="menu-item" href="{{ url_for('admin.index') }}"><i class="fas fa-arrow-left me-2"></i> Quay lại Dashboard</a>
        </div>
    </div>

    <div class="main-content">
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="alert alert-{{ category }}">
                        <i class="fas fa-info-circle"></i> {{ message }}
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}

        <div class="header-form">
            <h2 style="color:#2c3e50; margin:0;">{{ title }}</h2>
        </div>

        <div class="form-container">
            <form method="POST">
                {{ form.hidden_tag() }}
                
                {% for field in form %}
                    {% if field.name not in ['csrf_token', 'submit'] %}
                        <div class="form-group">
                            {{ field.label }}
                            {{ field }}
                            {% if field.errors %}
                                <div style="color:#e74c3c; font-size:0.9rem; margin-top:5px;">
                                    <i class="fas fa-exclamation-triangle me-1"></i>
                                    {% for error in field.errors %}{{ error }}{% endfor %}
                                </div>
                            {% endif %}
                        </div>
                    {% endif %}
                {% endfor %}

                <div style="margin-top:40px; text-align:right; border-top: 1px solid #eee; padding-top: 20px;">
                    <a href="{{ url_for('admin.index') }}" class="btn btn-secondary">Hủy bỏ</a>
                    <button type="submit" class="btn btn-primary"><i class="fas fa-save"></i> Lưu dữ liệu</button>
                </div>
            </form>
        </div>
    </div>
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

    <style>
        /* Làm cho ô chọn to và dễ nhìn hơn */
        .select2-container--default .select2-selection--single {
            height: 50px !important;
            border: 1px solid #ddd !important;
            border-radius: 8px !important;
            padding: 10px !important;
        }
        .select2-container { width: 100% !important; }
    </style>

    <script>
        $(document).ready(function() {
            // Kích hoạt ô tìm kiếm cho tất cả các dropdown
            $('select').select2({
                placeholder: "Nhập Tên hoặc CCCD để tìm nhanh...",
                allowClear: true,
                language: {
                    noResults: function() { return "Không tìm thấy người này..."; }
                }
            });
        });
    </script>
    <style>
    /* Giới hạn chiều cao của danh sách kết quả để có thể "lướt xuống" */
    .select2-results__options {
        max-height: 300px !important; /* Chiều cao tối đa 300px, quá mức này sẽ hiện thanh cuộn */
        overflow-y: auto !important;
    }

    /* Làm cho ô tìm kiếm nổi bật hơn */
    .select2-search__field {
        padding: 10px !important;
        border-radius: 5px !important;
    }

    /* Hiển thị rõ ràng từng dòng kết quả */
    .select2-results__option {
        padding: 12px 15px !important;
        border-bottom: 1px solid #f0f0f0;
    }

    .select2-results__option--highlighted {
        background-color: #3498db !important;
    }
    </style>

    <script>
        $(document).ready(function() {
            $('select').select2({
                placeholder: "Gõ Mã hộ, Số nhà hoặc Tên người để tìm...",
                allowClear: true,
                width: '100%',
                dropdownParent: $('.form-container'), // Đảm bảo danh sách không bị che khuất
                language: {
                    noResults: function() { return "Không tìm thấy dữ liệu..."; }
                }
            });
        });
    </script>

    <style>
    /* Ép danh sách hiển thị theo hàng dọc */
    .select2-results__options {
        max-height: 250px !important; /* Chiều cao tối đa để lướt xuống */
        overflow-y: auto !important;
        display: flex;
        flex-direction: column;
    }

    .select2-results__option {
        padding: 10px 15px !important;
        border-bottom: 1px solid #f0f0f0; /* Đường kẻ ngang giữa các dòng */
    }

    /* Đảm bảo ô tìm kiếm chiếm hết chiều rộng dòng */
    .select2-container { width: 100% !important; margin-top: 5px; }
    .select2-selection--single { height: 45px !important; border-radius: 8px !important; padding: 8px !important; }
    </style>

    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

    <script>
        $(document).ready(function() {
            $('select').select2({
                placeholder: "Gõ Tên, CCCD hoặc Địa chỉ để tìm nhanh...",
                allowClear: true,
                language: {
                    noResults: function() { return "Không tìm thấy dữ liệu..."; }
                }
            });
        });
    </script>
</body>
</html>